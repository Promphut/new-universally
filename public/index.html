<!DOCTYPE html>
<html>
<head>
  <script type="text/javascript">
    var config = <%= JSON.stringify(htmlWebpackPlugin.options.config) %>;
    //console.log('CONFIG1', config);
    // ==== GOOGLE TAG MGR ====
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer', config.ANALYTIC.TAGMGRID);
  </script>

  <!--<title>The Publisher</title>-->
  <meta charset="UTF-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.1.1/normalize.min.css" />

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.6.0/slick.min.css" />
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.6.0/slick-theme.min.css" />
  
  <link href="https://fonts.googleapis.com/css?family=Mitr|Nunito|PT+Sans|PT+Serif|Roboto|Roboto+Slab" rel="stylesheet"/>

  <script src="https://use.fontawesome.com/3df470c471.js"></script>

  <script type="text/javascript">
    var doc = document.documentElement;

    window.getWidth = () => {
      return window.innerWidth || doc.clientWidth || document.getElementsByTagName('body')[0].clientWidth;
    };

    window.getHeight = () => {
      return window.innerHeight || doc.clientHeight || document.getElementsByTagName('body')[0].clientHeight;
    };

    window.getScrollX = () => {
      return (window.pageXOffset || doc.scrollLeft) - (doc.clientLeft || 0);
    };

    window.getScrollY = () => {
      return (window.pageYOffset || doc.scrollTop)  - (doc.clientTop || 0);
    };
    window.isMobile = () => {
      return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    };

    window.getFbUrl = (fbid) => {
      return 'http://facebook.com/'+fbid;
    };
    window.getTwtUrl = (username) => {
      return 'http://twitter.com/'+username;
    };
    window.getIgUrl = (username) => {
      return 'http://instagram.com/'+username;
    };
    window.getYtUrl = (username) => {
      // channel
      if(username.startsWith('UC') && username.length===24)
        return 'http://youtube.com/channel/'+username;

      // user
      return 'http://youtube.com/user/'+username;
    };

    // default twt tweet url
    window.getTweetUrl = (url, hashtags) => {
      return 'https://twitter.com/intent/tweet?url='+encodeURIComponent(url) + (hashtags ? '&hashtags='+hashtags : '');
    };

    // append UTM to url
    // utm: {source, medium, campaign, content}
    window.appendUTM = (url, utm) => {
      if(!utm) return url
      return url + '?' + 
        (utm ? 'utm_source='+encodeURIComponent(utm.source || config.DOMAIN)+'&' : '') +
        (utm && utm.medium ? 'utm_medium='+encodeURIComponent(utm.medium)+'&' : '') +
        (utm && utm.campaign ? 'utm_campaign='+encodeURIComponent(utm.campaign)+'&' : '') +
        (utm && utm.content ? 'utm_content='+encodeURIComponent(utm.content)+'&' : '')
    };

    window.getTrailingSid = (url) => {
      // Get sid by trailing the last param from url 
      // because all story url have trailing :sid
      let arr = url ? url.split('/') : window.location.href.split('/')
      return parseInt(arr[arr.length-1])
    };

    // ==== Quantcast Tag, part 1 ====
    var _qevents = _qevents || [];
    (function() {
      var elem = document.createElement('script');
      elem.src = (document.location.protocol == "https:" ? "https://secure" : "http://edge") + ".quantserve.com/quant.js";
      elem.async = true;
      elem.type = "text/javascript";
      var scpt = document.getElementsByTagName('script')[0];
      scpt.parentNode.insertBefore(elem, scpt);
    })();
  </script>
</head>
<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=<%=config.ANALYTIC.TAGMGRID%>"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

  <!-- FACEBOOK -->
  <div id="fb-root"></div>
  <script type="text/javascript">
    window.fbAsyncInit = function() {
      FB.init({
        appId      : config.ANALYTIC.FBAPPID,
        xfbml      : true,
        version    : 'v2.8'
      });
      FB.AppEvents.logPageView();
    };

    (function(d, s, id){
       var js, fjs = d.getElementsByTagName(s)[0];
       if (d.getElementById(id)) {return;}
       js = d.createElement(s); js.id = id;
       js.src = "//connect.facebook.net/en_US/sdk.js";
       fjs.parentNode.insertBefore(js, fjs);
     }(document, 'script', 'facebook-jssdk'));
  </script>

  <main id="app"></main>

  <script type="text/javascript">
    // ==== TWTTER WEB INTENT ====
    var tweetStory = new CustomEvent("tweetStory");

    window.twttr = (function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0],
        t = window.twttr || {};
      if (d.getElementById(id)) return t;
      js = d.createElement(s);
      js.id = id;
      js.src = "https://platform.twitter.com/widgets.js";
      fjs.parentNode.insertBefore(js, fjs);

      t._e = [];
      t.ready = function(f) {
        t._e.push(f);
      };

      return t;
    }(document, "script", "twitter-wjs"))

    twttr.ready(function (twttr) {
      //console.log(twttr.events)
      twttr.events.bind('tweet', function(event) {
        // dispatch DOM element event that added in TwtShareButton
        event.target.dispatchEvent(tweetStory);
      });
    });

    // ==== CHARTBEAT ====
    var _sf_async_config = _sf_async_config || {};
    /** CONFIGURATION START **/
    //console.log('CONFIG2', config);
    _sf_async_config.uid = config.ANALYTIC.CHARTBEATUID;
    _sf_async_config.domain = config.DOMAIN; //CHANGE THIS
    _sf_async_config.useCanonical = true;
    //_sf_async_config.sections = 'Change this to your Section name'; //CHANGE THIS
    //_sf_async_config.authors = 'Change this to your Author name'; //CHANGE THIS
    /** CONFIGURATION END **/
    (function() {
        function loadChartbeat() {
            var e = document.createElement('script');
            e.setAttribute('language', 'javascript');
            e.setAttribute('type', 'text/javascript');
            e.setAttribute('src', '//static.chartbeat.com/js/chartbeat.js');
            document.body.appendChild(e);
        }
        var oldonload = window.onload;
        window.onload = (typeof window.onload != 'function') ?
            loadChartbeat : function() {
                oldonload();
                loadChartbeat();
            };
    })();

    // ==== Quantcast Tag, part 2 ====
    _qevents.push( { qacct: config.ANALYTIC.QUANTCASTACC} );
  </script>
  <!-- Quantcast Tag, part 2 -->
  <noscript>
    <div style="display: none;">
      <img src="//pixel.quantserve.com/pixel/<%=config.ANALYTIC.QUANTCASTACC%>.gif" height="1" width="1" alt="Quantcast"/>
    </div>
  </noscript>

</body>
</html>
